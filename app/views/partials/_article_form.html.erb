<div class="modal fade" id="article-creation-form" tabindex="-1" role="dialog" aria-labelledby="article-form-label" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="article-form-label">Create your new article</h4>
            </div>
            <%= form_for(@article, html: { multipart: true }) do |f| %>
                <div class="modal-body">
                    <%= render 'partials/error_messages', object: f.object %>

                    <div class="form-group">
                        <%= f.label :title, class: 'control-label' %>
                        <%= f.text_field :title, class: 'form-control input-lg', placeholder: 'article title' %>
                    </div>
                    <div class="form-group">
                        <%= f.label :content, class: 'control-label' %>
                        <%= f.text_area :content, class: 'form-control', rows: 6, placeholder: 'article content' %>
                    </div>
                    <div class="form-group">
                        <%= f.label :tag_list, class: 'control-label' %>
                        <%= f.select :tag_list, Tag.all.collect { |t| [t.name, t.name] }, {},
                                     {id: 'tags-list-selection', class: 'form-control', multiple: true} %>
                    </div>
                    <div class="form-group">
                        <%= f.label :picture, class: 'control-label' %>
                        <%= f.file_field :picture, accept: 'image/jpeg,image/gif,image/png' %>
                        <p class="help-block">Choose your picture to upload</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-success">Create article</button>
                </div>
            <% end %>
        </div>
    </div>
</div>

<script>
    $(function() {
        var $articleForm = $('#article-creation-form');
        var $articleTitle = $('#article_title');
        var $picture = $('#article_picture');
        var $selectBox = $('#tags-list-selection');

        $selectBox.select2({
            placeholder: 'select tags for your article',
            allowClear: true
        });

        $picture.bind('change', function() {
            var size_in_megabytes = this.files[0].size / 1024 / 1024;
            if (size_in_megabytes > 5) {
                alert('Maximum file size is 5MB. Please choose a smaller file.');
            }
        });

        $articleForm.on('shown.bs.modal', function() {
            $articleTitle.focus()
        });

        <% if @article.errors.any? %>
            $articleForm.modal('show');
        <% end %>
    });
</script>
